<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>USC Ridesharing</title>
        <style>
                #map {
            width:100%;
            height:400px;
            background-color: grey;
            }
        </style>
    </head>
    <body>
    <div id="map"></div>
    <div id="brum" style="background-color: pink; width: 100%; height: 100px;" onclick="ba();"></div>
    <script>
        let waypoints  = [];
        let cities = [];
        function initMap() {
            let southCarolina = {lat: 33.8361, lng: -81.1637};
            let map = new google.maps.Map( //creating map object
                document.getElementById('map'), {zoom: 7, center: southCarolina}
            );
            //defining important locations
            let columbia = {lat: 34.0007, lng: -81.0348};
            let charleston = {lat: 32.7765, lng: -79.9311};
            let orangeburg = {lat: 33.4918203, lng: -80.8556476};
            let jamison = {lat: 33.582098, lng: -80.8178688};
            let cayce = {lat: 33.96570910000001, lng: -81.0739827};
            let faridabad = {lat: 28.4089, lng: 77.3178};
            let ghaziabad = {lat: 28.6692, lng: 77.4538};
            let newjersey = {lat: 40.7177545, lng: -74.0431435};
            let mountpleasant = {lat: 32.8323225, lng: -79.82842579999999};
            let northcharleston = {lat: 32.8771106, lng: -80.0130514};
            let summerville = {lat: 33.0185039, lng: -80.17564809999999};
            var directionsService = new google.maps.DirectionsService(); //googlemap
            var directionsRenderer = new google.maps.DirectionsRenderer(); //googlemap
            directionsRenderer.setMap(map);
            var request = {
                origin: columbia,
                destination: newjersey,
                travelMode: 'DRIVING'
            };
            directionsService.route(request, function(result, status) {
                if (status == 'OK') {
                    directionsRenderer.setDirections(result);
                    //alert(result.routes[0].overview_polyline);
                    waypoints = google.maps.geometry.encoding.decodePath(result.routes[0].overview_polyline); //used in PolygonPoints function
                    const PolygonCoords = PolygonPoints();
                    const PolygonBound = new google.maps.Polygon({ //creating a polygon around the route using the points generated
                        paths: PolygonCoords, 
                        strokeColor: "#FF0000",
                        strokeOpacity: 0.8, 
                        strokeWeight: 2, 
                        fillColor: "#FF0000",
                        fillOpacity: 0.35,
                    });
                    /*
                    const startCircle = new google.maps.Circle({
                        strokeColor: "#FF0000",
                        strokeOpacity: 0.8,
                        strokeWeight: 2,
                        fillColor: "#FF0000",
                        fillOpacity: 0.35,
                        map, 
                        center: columbia,
                        radius: 30000,
                    });

                    
                    */
                   /*
                    const endCircle = new google.maps.Circle({
                        strokeColor: "#FF0000",
                        strokeOpacity: 0.8,
                        strokeWeight: 2,
                        fillColor: "#FF0000",
                        fillOpacity: 0.35,
                        map, 
                        center: ghaziabad,
                        radius: 20000,
                    })
                `*/
                    PolygonBound.setMap(map);
                    directionsRenderer.setMap(map);
                    //alert(google.maps.geometry.poly.containsLocation(mountpleasant,PolygonBound));
                }
            });
        }
        function PolygonArray(latitude, longitude) { //function to create upper and lower bound points for polygon
            const R = 6378137;
            const pi = 3.14;
            
            const upper_offset = 10000;
            const lower_offset = -10000;
            Lat_up = upper_offset / R;
            Lat_down = lower_offset / R;

            lat_upper = latitude + (Lat_up * 180) / pi;
            lat_lower = latitude + (Lat_down * 180) / pi;
            lng_upper = longitude + (Lat_up * 180) / pi;
            lng_lower = longitude + (Lat_down * 180) /pi;

            return [[lat_upper, lat_lower], [lng_upper,lng_lower]];
        }

        function PolygonPoints() { //function to create polygon points around route with an upper bound and lower bound
            let polypoints = [];
            for(let x = 0; x < waypoints.length; x++)
            {
                polypoints.push(waypoints[x]);
            }
            let Polylength = polypoints.length;
            
            let UpperBound = [];
            let LowerBound = [];

            for (let j = 0; j <= Polylength - 1; j++) {
                let NewPoints = PolygonArray(polypoints[j].lat(),polypoints[j].lng());
                UpperBound.push({lat: NewPoints[0][0], lng: NewPoints[1][0]});
                LowerBound.push({lat: NewPoints[0][1], lng: NewPoints[1][1]});
            }

            let reversebound = LowerBound.reverse();

            let FullPoly = UpperBound.concat(reversebound);

            return FullPoly;
        }

        function findDistance(lat1,lat2, lon1, lon2) { //distance between two points based on haversine formula
        // The math module contains a function
        // named toRadians which converts from
        // degrees to radians.
        lon1 =  lon1 * Math.PI / 180;
        lon2 = lon2 * Math.PI / 180;
        lat1 = lat1 * Math.PI / 180;
        lat2 = lat2 * Math.PI / 180;
   
        // Haversine formula
        let dlon = lon2 - lon1;
        let dlat = lat2 - lat1;
        let a = Math.pow(Math.sin(dlat / 2), 2)
                 + Math.cos(lat1) * Math.cos(lat2)
                 * Math.pow(Math.sin(dlon / 2),2);
               
        let c = 2 * Math.asin(Math.sqrt(a));
   
        // Radius of earth in kilometers. Use 3956
        // for miles
        let r = 6371;
   
        // calculate the result
        return(c * r);
        }

        function isinmiddle() {

        }
    </script>
    <script async src=""></script>
  </body>
  </html>